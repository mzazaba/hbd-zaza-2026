<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>HAPPY BIRTHDAY ANGEL ZAZABA</title>
<!-- ç§»åŠ¨ç«¯è§†å£è®¾ç½® -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
body {
    background: #000;
    margin: 0;
    overflow: hidden;
}

canvas {
    cursor: crosshair;
    display: block;
    width: 100vw;
    height: 100vh;
}

/* éŸ³é¢‘æç¤ºæ ·å¼ - ä»…éšè—æç¤ºï¼Œä¸å½±å“ç”»å¸ƒ */
#audioTip {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 24px;
    background: rgba(0,0,0,0.8);
    padding: 20px 30px;
    border-radius: 15px;
    z-index: 100;
    transition: opacity 0.5s ease;
    text-align: center;
    width: 80%;
    max-width: 400px;
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
    /* åˆå§‹æ˜¾ç¤º */
    opacity: 1;
    pointer-events: auto;
}

/* ä»…éšè—æç¤ºçš„é€æ˜åº¦ï¼Œä¸åˆ é™¤å…ƒç´  */
#audioTip.hidden {
    opacity: 0;
    pointer-events: none;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="audioTip">ğŸ‚ click me  ğŸµ</div>
<audio id="bgMusic" src="./hbdzaza.mpeg" loop preload="auto"></audio>

<script>
// æ ¸å¿ƒä¿®å¤ï¼šåˆ†ç¦»éŸ³é¢‘æ’­æ”¾å’Œäº‹ä»¶ç§»é™¤é€»è¾‘
const audio = document.getElementById('bgMusic');
const audioTip = document.getElementById('audioTip');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let isAudioPlayed = false; // ä»…æ ‡è®°éŸ³é¢‘æ˜¯å¦æ’­æ”¾ï¼Œä¸ç§»é™¤äº¤äº’äº‹ä»¶
let cw = window.innerWidth;
let ch = window.innerHeight;

// ========== éŸ³é¢‘æ’­æ”¾é€»è¾‘ï¼ˆä¿®å¤æ ¸å¿ƒï¼‰==========
function playAudio(e) {
    if (e) e.preventDefault(); // ä»…é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œä¸ç§»é™¤äº‹ä»¶
    
    if (isAudioPlayed) return; // é˜²æ­¢é‡å¤æ’­æ”¾
    
    audio.play()
        .then(() => {
            console.log('éŸ³ä¹æ’­æ”¾æˆåŠŸ');
            isAudioPlayed = true;
            audio.muted = false;
            audioTip.classList.add('hidden'); // ä»…éšè—æç¤ºï¼Œä¸å½±å“ç”»å¸ƒ
        })
        .catch(error => {
            console.log('æ’­æ”¾å¤±è´¥ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ:', error);
            // é™çº§æ–¹æ¡ˆï¼šä»…è§£é™¤é™éŸ³ï¼Œä¸ç§»é™¤äº‹ä»¶
            audio.muted = false;
            audio.currentTime = 0;
            audio.play().catch(err => {
                audioTip.textContent = 'è¯·æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æˆ–æµè§ˆå™¨è®¾ç½®';
            });
            isAudioPlayed = true;
            audioTip.classList.add('hidden');
        });
}

// ========== ç”»å¸ƒå°ºå¯¸é€‚é…ï¼ˆä¿®å¤åˆå§‹åŒ–é”™è¯¯ï¼‰==========
function resizeCanvas() {
    cw = window.innerWidth;
    ch = window.innerHeight;
    canvas.width = cw;
    canvas.height = ch;
}

// åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// ========== ç»‘å®šäº¤äº’äº‹ä»¶ï¼ˆä¿ç•™æ‰€æœ‰äº‹ä»¶ï¼Œä¸ç§»é™¤ï¼‰==========
// éŸ³é¢‘æ’­æ”¾äº‹ä»¶ï¼ˆä¿ç•™ï¼Œä»…è§¦å‘ä¸€æ¬¡æ’­æ”¾ï¼‰
document.addEventListener('click', playAudio);
document.addEventListener('touchstart', playAudio, { passive: false });
canvas.addEventListener('click', playAudio);
canvas.addEventListener('touchstart', playAudio, { passive: false });

// ========== åŸæœ‰çƒŸèŠ±åŠ¨ç”»é€»è¾‘ï¼ˆå®Œæ•´ä¿ç•™ï¼‰==========
window.requestAnimFrame = (function() {
    return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function( callback ) {
                    window.setTimeout( callback, 1000 / 60 );
                };
})();

// çƒŸèŠ±ç›¸å…³å˜é‡
let fireworks = [];
let particles = [];
let hue = 120;
let limiterTotal = 5;
let limiterTick = 0;
let timerTotal = 80;
let timerTick = 0;
let mousedown = false;
let mx = cw / 2;
let my = ch / 2;

// å·¥å…·å‡½æ•°
function random( min, max ) {
    return Math.random() * ( max - min ) + min;
}

function calculateDistance( p1x, p1y, p2x, p2y ) {
    var xDistance = p1x - p2x;
    var yDistance = p1y - p2y;
    return Math.sqrt( Math.pow( xDistance, 2 ) + Math.pow( yDistance, 2 ) );
}

// çƒŸèŠ±ç±»
function Firework( sx, sy, tx, ty ) {
    this.x = sx;
    this.y = sy;
    this.sx = sx;
    this.sy = sy;
    this.tx = tx;
    this.ty = ty;
    this.distanceToTarget = calculateDistance( sx, sy, tx, ty );
    this.distanceTraveled = 0;
    this.coordinates = [];
    this.coordinateCount = 3;
    while( this.coordinateCount-- ) {
        this.coordinates.push( [ this.x, this.y ] );
    }
    this.angle = Math.atan2( ty - sy, tx - sx );
    this.speed = 2;
    this.acceleration = 1.05;
    this.brightness = random( 50, 70 );
    this.targetRadius = 1;
}

Firework.prototype.update = function( index ) {
    this.coordinates.pop();
    this.coordinates.unshift( [ this.x, this.y ] );
    
    if( this.targetRadius < 8 ) {
        this.targetRadius += 0.3;
    } else {
        this.targetRadius = 1;
    }
    
    this.speed *= this.acceleration;
    
    var vx = Math.cos( this.angle ) * this.speed;
    var vy = Math.sin( this.angle ) * this.speed;
    this.distanceTraveled = calculateDistance( this.sx, this.sy, this.x + vx, this.y + vy );
    
    if( this.distanceTraveled >= this.distanceToTarget ) {
        createParticles( this.tx, this.ty );
        fireworks.splice( index, 1 );
    } else {
        this.x += vx;
        this.y += vy;
    }
}

Firework.prototype.draw = function() {
    ctx.beginPath();
    ctx.moveTo( this.coordinates[ this.coordinates.length - 1][ 0 ], this.coordinates[ this.coordinates.length - 1][ 1 ] );
    ctx.lineTo( this.x, this.y );
    ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
    ctx.stroke();
    
    ctx.beginPath();
    ctx.arc( this.tx, this.ty, this.targetRadius, 0, Math.PI * 2 );
    ctx.stroke();
}

// ç²’å­ç±»
function Particle( x, y ) {
    this.x = x;
    this.y = y;
    this.coordinates = [];
    this.coordinateCount = 5;
    while( this.coordinateCount-- ) {
        this.coordinates.push( [ this.x, this.y ] );
    }
    this.angle = random( 0, Math.PI * 2 );
    this.speed = random( 1, 10 );
    this.friction = 0.95;
    this.gravity = 1;
    this.hue = random( hue - 20, hue + 20 );
    this.brightness = random( 50, 80 );
    this.alpha = 1;
    this.decay = random( 0.015, 0.03 );
}

Particle.prototype.update = function( index ) {
    this.coordinates.pop();
    this.coordinates.unshift( [ this.x, this.y ] );
    this.speed *= this.friction;
    this.x += Math.cos( this.angle ) * this.speed;
    this.y += Math.sin( this.angle ) * this.speed + this.gravity;
    this.alpha -= this.decay;
    
    if( this.alpha <= this.decay ) {
        particles.splice( index, 1 );
    }
}

Particle.prototype.draw = function() {
    ctx.beginPath();
    ctx.moveTo( this.coordinates[ this.coordinates.length - 1 ][ 0 ], this.coordinates[ this.coordinates.length - 1 ][ 1 ] );
    ctx.lineTo( this.x, this.y );
    ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
    ctx.stroke();
}

function createParticles( x, y ) {
    var particleCount = 30;
    while( particleCount-- ) {
        particles.push( new Particle( x, y ) );
    }
}

// ä¸»å¾ªç¯ï¼ˆæ ¸å¿ƒï¼šç¡®ä¿æŒç»­æ¸²æŸ“ï¼‰
function loop() {
    requestAnimFrame( loop );
    hue += 0.5;
    
    // ä¿ç•™ç”»å¸ƒæ¸…ç©ºé€»è¾‘ï¼Œè¿™æ˜¯æ­£å¸¸çš„åŠ¨ç”»æ¸²æŸ“
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
    ctx.fillRect( 0, 0, cw, ch );
    ctx.globalCompositeOperation = 'lighter';
    
    // æ–‡å­—é€‚é…
    var text = "HAPPY BIRTHDAY ZAZABA !!";  
    var fontSize = window.innerWidth < 768 ? "30px" : "50px";
    ctx.font = fontSize + " sans-serif";
    var textData = ctx.measureText(text);
    ctx.fillStyle = "rgba("+parseInt(random(0,255))+","+parseInt(random(0,255))+","+parseInt(random(0,255))+",0.3)";
    ctx.fillText(text, cw/2 - textData.width/2, ch/2); 
    
    // æ¸²æŸ“çƒŸèŠ±
    var i = fireworks.length;
    while( i-- ) {
        fireworks[ i ].draw();
        fireworks[ i ].update( i );
    }
    
    // æ¸²æŸ“ç²’å­
    i = particles.length;
    while( i-- ) {
        particles[ i ].draw();
        particles[ i ].update( i );
    }
    
    // è‡ªåŠ¨å‘å°„çƒŸèŠ±
    if( timerTick >= timerTotal ) {
        if( !mousedown ) {
            for(var h=0; h<50; h++) {
                fireworks.push( new Firework( cw / 2, ch/2, random( 0, cw ), random( 0, ch ) ) );
            }
            timerTick = 0;
        }
    } else {
        timerTick++;
    }
    
    // ç‚¹å‡»/è§¦æ‘¸å‘å°„çƒŸèŠ±
    if( limiterTick >= limiterTotal ) {
        if( mousedown ) {
            fireworks.push( new Firework( cw / 2, ch/2, mx, my ) );
            limiterTick = 0;
        }
    } else {
        limiterTick++;
    }
}

// ========== äº¤äº’äº‹ä»¶ï¼ˆå®Œæ•´ä¿ç•™ï¼Œç¡®ä¿ç‚¹å‡»åä»èƒ½æ§åˆ¶çƒŸèŠ±ï¼‰==========
// ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
canvas.addEventListener( 'touchmove', function( e ) {
    if (e.touches && e.touches[0]) {
        mx = e.touches[0].pageX - canvas.offsetLeft;
        my = e.touches[0].pageY - canvas.offsetTop;
    }
});

canvas.addEventListener( 'touchstart', function( e ) {
    e.preventDefault();
    mousedown = true;
    if (e.touches && e.touches[0]) {
        mx = e.touches[0].pageX - canvas.offsetLeft;
        my = e.touches[0].pageY - canvas.offsetTop;
    }
});

canvas.addEventListener( 'touchend', function( e ) {
    e.preventDefault();
    mousedown = false;
});

// PCç«¯é¼ æ ‡äº‹ä»¶
canvas.addEventListener( 'mousemove', function( e ) {
    mx = e.pageX - canvas.offsetLeft;
    my = e.pageY - canvas.offsetTop;
});

canvas.addEventListener( 'mousedown', function( e ) {
    e.preventDefault();
    mousedown = true;
});

canvas.addEventListener( 'mouseup', function( e ) {
    e.preventDefault();
    mousedown = false;
});

// å¯åŠ¨åŠ¨ç”»å¾ªç¯ï¼ˆç¡®ä¿é¡µé¢åŠ è½½åæŒç»­æ¸²æŸ“ï¼‰
window.onload = loop;
</script>

</body>
</html>
