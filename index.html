<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>HAPPY BIRTHDAY ANGEL ZAZABA</title>
<!-- æ ¸å¿ƒï¼šå“åº”å¼è§†å£è®¾ç½® -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<style>
/* å…¨å±€é‡ç½® */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* åŸºç¡€æ ·å¼ - é€‚é…æ‰€æœ‰å±å¹• */
body {
    background: #000;
    margin: 0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    /* é€‚é…åˆ˜æµ·å±/æŒ–å­”å± */
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

/* ç”»å¸ƒæ ·å¼ - å…¨å±å¹•é€‚é… */
canvas {
    cursor: crosshair;
    display: block;
    width: 100%;
    height: 100%;
    /* ç¡®ä¿ç”»å¸ƒå§‹ç»ˆè¦†ç›–è§†å£ */
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1;
}

/* éŸ³é¢‘æç¤º - å“åº”å¼æ ·å¼ */
#audioTip {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    background: rgba(0,0,0,0.85);
    padding: clamp(15px, 4vw, 30px) clamp(20px, 5vw, 40px);
    border-radius: clamp(10px, 3vw, 15px);
    z-index: 100;
    transition: opacity 0.5s ease;
    text-align: center;
    width: clamp(280px, 80%, 450px);
    box-shadow: 0 0 clamp(10px, 3vw, 20px) rgba(255,255,255,0.3);
    opacity: 1;
    pointer-events: auto;
    /* å“åº”å¼å­—ä½“ */
    font-size: clamp(18px, 5vw, 24px);
    line-height: 1.5;
}

/* éšè—æç¤ºçš„çŠ¶æ€ */
#audioTip.hidden {
    opacity: 0;
    pointer-events: none;
}

/* é€‚é…æ¨ªå±/ç«–å± */
@media screen and (orientation: landscape) and (max-height: 500px) {
    #audioTip {
        padding: clamp(10px, 3vw, 20px) clamp(15px, 4vw, 30px);
        font-size: clamp(16px, 4vw, 20px);
        width: clamp(250px, 70%, 400px);
    }
}

/* å¤§å±é€‚é… */
@media screen and (min-width: 1920px) {
    #audioTip {
        font-size: 28px;
        padding: 25px 40px;
        width: 500px;
    }
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="audioTip">ğŸ‚ click meğŸµ</div>
<audio id="bgMusic" src="./hbdzaza.mpeg" loop preload="auto"></audio>

<script>
// å…¨å±€å˜é‡
const audio = document.getElementById('bgMusic');
const audioTip = document.getElementById('audioTip');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let isAudioPlayed = false;
let cw, ch; // ç”»å¸ƒå®½é«˜
let fireworks = [];
let particles = [];
let hue = 120;
let limiterTotal = 5;
let limiterTick = 0;
let timerTotal = 80;
let timerTick = 0;
let mousedown = false;
let mx, my;

// ========== æ ¸å¿ƒï¼šå“åº”å¼ç”»å¸ƒé€‚é… ==========
function resizeCanvas() {
    // è·å–çœŸå®è§†å£å°ºå¯¸ï¼ˆé€‚é…å„ç§å±å¹•ï¼‰
    cw = window.innerWidth;
    ch = window.innerHeight;
    
    // è®¾ç½®ç”»å¸ƒå®é™…åƒç´ å°ºå¯¸ï¼ˆè§£å†³æ¨¡ç³Šé—®é¢˜ï¼‰
    const dpr = window.devicePixelRatio || 1;
    canvas.width = cw * dpr;
    canvas.height = ch * dpr;
    canvas.style.width = `${cw}px`;
    canvas.style.height = `${ch}px`;
    
    // ç¼©æ”¾ä¸Šä¸‹æ–‡ï¼Œé€‚é…é«˜æ¸…å±
    ctx.scale(dpr, dpr);
    
    // é‡ç½®é¼ æ ‡/è§¦æ‘¸ä½ç½®
    mx = cw / 2;
    my = ch / 2;
}

// ========== éŸ³é¢‘æ’­æ”¾é€»è¾‘ ==========
function playAudio(e) {
    if (e) e.preventDefault();
    if (isAudioPlayed) return;
    
    audio.play()
        .then(() => {
            isAudioPlayed = true;
            audio.muted = false;
            audioTip.classList.add('hidden');
        })
        .catch(error => {
            audio.muted = false;
            audio.currentTime = 0;
            audio.play().catch(err => {
                audioTip.textContent = 'è¯·æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æˆ–æµè§ˆå™¨è®¾ç½®';
            });
            isAudioPlayed = true;
            audioTip.classList.add('hidden');
        });
}

// ========== å·¥å…·å‡½æ•° ==========
function random( min, max ) {
    return Math.random() * ( max - min ) + min;
}

function calculateDistance( p1x, p1y, p2x, p2y ) {
    var xDistance = p1x - p2x;
    var yDistance = p1y - p2y;
    return Math.sqrt( Math.pow( xDistance, 2 ) + Math.pow( yDistance, 2 ) );
}

// ========== çƒŸèŠ±ç±»ï¼ˆå“åº”å¼ä¼˜åŒ–ï¼‰ ==========
function Firework( sx, sy, tx, ty ) {
    this.x = sx;
    this.y = sy;
    this.sx = sx;
    this.sy = sy;
    this.tx = tx;
    this.ty = ty;
    this.distanceToTarget = calculateDistance( sx, sy, tx, ty );
    this.distanceTraveled = 0;
    this.coordinates = [];
    // å“åº”å¼è½¨è¿¹æ•°é‡
    this.coordinateCount = cw < 768 ? 2 : 3;
    while( this.coordinateCount-- ) {
        this.coordinates.push( [ this.x, this.y ] );
    }
    this.angle = Math.atan2( ty - sy, tx - sx );
    // å“åº”å¼é€Ÿåº¦
    this.speed = cw < 768 ? 1.5 : 2;
    this.acceleration = 1.05;
    this.brightness = random( 50, 70 );
    this.targetRadius = 1;
}

Firework.prototype.update = function( index ) {
    this.coordinates.pop();
    this.coordinates.unshift( [ this.x, this.y ] );
    
    if( this.targetRadius < 8 ) {
        this.targetRadius += 0.3;
    } else {
        this.targetRadius = 1;
    }
    
    this.speed *= this.acceleration;
    
    var vx = Math.cos( this.angle ) * this.speed;
    var vy = Math.sin( this.angle ) * this.speed;
    this.distanceTraveled = calculateDistance( this.sx, this.sy, this.x + vx, this.y + vy );
    
    if( this.distanceTraveled >= this.distanceToTarget ) {
        createParticles( this.tx, this.ty );
        fireworks.splice( index, 1 );
    } else {
        this.x += vx;
        this.y += vy;
    }
}

Firework.prototype.draw = function() {
    ctx.beginPath();
    ctx.moveTo( this.coordinates[ this.coordinates.length - 1][ 0 ], this.coordinates[ this.coordinates.length - 1][ 1 ] );
    ctx.lineTo( this.x, this.y );
    ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
    // å“åº”å¼çº¿æ¡å®½åº¦
    ctx.lineWidth = cw < 768 ? 1 : 1.5;
    ctx.stroke();
    
    ctx.beginPath();
    ctx.arc( this.tx, this.ty, this.targetRadius, 0, Math.PI * 2 );
    ctx.stroke();
}

// ========== ç²’å­ç±»ï¼ˆå“åº”å¼ä¼˜åŒ–ï¼‰ ==========
function Particle( x, y ) {
    this.x = x;
    this.y = y;
    this.coordinates = [];
    // å“åº”å¼è½¨è¿¹æ•°é‡
    this.coordinateCount = cw < 768 ? 3 : 5;
    while( this.coordinateCount-- ) {
        this.coordinates.push( [ this.x, this.y ] );
    }
    this.angle = random( 0, Math.PI * 2 );
    // å“åº”å¼é€Ÿåº¦
    this.speed = random( cw < 768 ? 0.8 : 1, cw < 768 ? 8 : 10 );
    this.friction = 0.95;
    this.gravity = cw < 768 ? 0.8 : 1;
    this.hue = random( hue - 20, hue + 20 );
    this.brightness = random( 50, 80 );
    this.alpha = 1;
    this.decay = random( 0.015, 0.03 );
}

Particle.prototype.update = function( index ) {
    this.coordinates.pop();
    this.coordinates.unshift( [ this.x, this.y ] );
    this.speed *= this.friction;
    this.x += Math.cos( this.angle ) * this.speed;
    this.y += Math.sin( this.angle ) * this.speed + this.gravity;
    this.alpha -= this.decay;
    
    if( this.alpha <= this.decay ) {
        particles.splice( index, 1 );
    }
}

Particle.prototype.draw = function() {
    ctx.beginPath();
    ctx.moveTo( this.coordinates[ this.coordinates.length - 1 ][ 0 ], this.coordinates[ this.coordinates.length - 1 ][ 1 ] );
    ctx.lineTo( this.x, this.y );
    ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
    // å“åº”å¼çº¿æ¡å®½åº¦
    ctx.lineWidth = cw < 768 ? 0.8 : 1;
    ctx.stroke();
}

function createParticles( x, y ) {
    // å“åº”å¼ç²’å­æ•°é‡
    var particleCount = cw < 768 ? 20 : 30;
    while( particleCount-- ) {
        particles.push( new Particle( x, y ) );
    }
}

// ========== ä¸»å¾ªç¯ï¼ˆå“åº”å¼æ¸²æŸ“ï¼‰ ==========
function loop() {
    requestAnimationFrame( loop );
    hue += 0.5;
    
    // æ¸…ç©ºç”»å¸ƒ
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
    ctx.fillRect( 0, 0, cw, ch );
    ctx.globalCompositeOperation = 'lighter';
    
    // å“åº”å¼æ–‡å­—
    var text = "HAPPY BIRTHDAY ZAZABA !!";
    // æ ¹æ®å±å¹•å®½åº¦åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°
    let fontSize;
    if (cw < 480) fontSize = "19px";          // å°å±æ‰‹æœº
    else if (cw < 768) fontSize = "26px";     // å¤§å±æ‰‹æœº
    else if (cw < 1200) fontSize = "40px";    // å¹³æ¿/å°å±ç”µè„‘
    else fontSize = "50px";                   // å¤§å±æ˜¾ç¤ºå™¨
    
    ctx.font = `${fontSize} sans-serif`;
    var textData = ctx.measureText(text);
    // æ–‡å­—ä½ç½®é€‚é…ï¼ˆå±…ä¸­ï¼‰
    const textX = (cw - textData.width) / 2;
    const textY = ch / 2;
    ctx.fillStyle = "rgba("+parseInt(random(0,255))+","+parseInt(random(0,255))+","+parseInt(random(0,255))+",0.3)";
    ctx.fillText(text, textX, textY); 
    
    // æ¸²æŸ“çƒŸèŠ±
    var i = fireworks.length;
    while( i-- ) {
        fireworks[ i ].draw();
        fireworks[ i ].update( i );
    }
    
    // æ¸²æŸ“ç²’å­
    i = particles.length;
    while( i-- ) {
        particles[ i ].draw();
        particles[ i ].update( i );
    }
    
    // å“åº”å¼è‡ªåŠ¨å‘å°„é¢‘ç‡
    const autoFireRate = cw < 768 ? 60 : 80;
    if( timerTick >= autoFireRate ) {
        if( !mousedown ) {
            // å“åº”å¼å‘å°„æ•°é‡
            const fireCount = cw < 768 ? 30 : 50;
            for(var h=0; h<fireCount; h++) {
                fireworks.push( new Firework( cw / 2, ch/2, random( 0, cw ), random( 0, ch ) ) );
            }
            timerTick = 0;
        }
    } else {
        timerTick++;
    }
    
    if( limiterTick >= limiterTotal ) {
        if( mousedown ) {
            fireworks.push( new Firework( cw / 2, ch/2, mx, my ) );
            limiterTick = 0;
        }
    } else {
        limiterTick++;
    }
}

// ========== äº‹ä»¶ç›‘å¬ ==========
// éŸ³é¢‘æ’­æ”¾äº‹ä»¶
document.addEventListener('click', playAudio);
document.addEventListener('touchstart', playAudio, { passive: false });
canvas.addEventListener('click', playAudio);
canvas.addEventListener('touchstart', playAudio, { passive: false });

// å°ºå¯¸å˜åŒ–ç›‘å¬ï¼ˆå±å¹•æ—‹è½¬/çª—å£è°ƒæ•´ï¼‰
window.addEventListener('resize', resizeCanvas);
window.addEventListener('orientationchange', resizeCanvas); // å±å¹•æ—‹è½¬

// è§¦æ‘¸/é¼ æ ‡äº‹ä»¶
canvas.addEventListener('touchmove', function( e ) {
    if (e.touches && e.touches[0]) {
        mx = e.touches[0].pageX - canvas.offsetLeft;
        my = e.touches[0].pageY - canvas.offsetTop;
    }
});

canvas.addEventListener('touchstart', function( e ) {
    e.preventDefault();
    mousedown = true;
    if (e.touches && e.touches[0]) {
        mx = e.touches[0].pageX - canvas.offsetLeft;
        my = e.touches[0].pageY - canvas.offsetTop;
    }
});

canvas.addEventListener('touchend', function( e ) {
    e.preventDefault();
    mousedown = false;
});

canvas.addEventListener('mousemove', function( e ) {
    mx = e.pageX - canvas.offsetLeft;
    my = e.pageY - canvas.offsetTop;
});

canvas.addEventListener('mousedown', function( e ) {
    e.preventDefault();
    mousedown = true;
});

canvas.addEventListener('mouseup', function( e ) {
    e.preventDefault();
    mousedown = false;
});

// ========== åˆå§‹åŒ– ==========
function init() {
    // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
    resizeCanvas();
    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    loop();
    // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘ï¼ˆå¤§éƒ¨åˆ†æµè§ˆå™¨ä¼šå¤±è´¥ï¼‰
    audio.play().catch(() => {
        audioTip.classList.remove('hidden');
    });
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('load', init);
// é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ¢å¤æ’­æ”¾
document.addEventListener('visibilitychange', () => {
    if (!document.hidden && isAudioPlayed) {
        audio.play();
    }
});
</script>

</body>
</html>

